# This symbol is outside the eudev if-block, so that we do not have
# a circular dependency in kconfig. Thus, we need the dummy symbol,
# below, to inform the user that the daemon has indeed been enabled.
config BR2_PACKAGE_EUDEV_DAEMON
	bool
	select BR2_PACKAGE_HAS_UDEV
	select BR2_PACKAGE_UDEV_GENTOO_SCRIPTS if BR2_INIT_OPENRC
	select BR2_PACKAGE_UTIL_LINUX
	select BR2_PACKAGE_UTIL_LINUX_LIBS
	select BR2_PACKAGE_UTIL_LINUX_LIBBLKID
	# We can select this has we're sure eudev is selected when we are.
	select BR2_PACKAGE_EUDEV_DAEMON_DUMMY

config BR2_PACKAGE_EUDEV
	bool "eudev"
	depends on BR2_USE_MMU # uses fork()
	depends on BR2_USE_WCHAR # needs C99 compiler
	depends on !BR2_STATIC_LIBS # dlfcn.h
	depends on !BR2_INIT_SYSTEMD
	select BR2_PACKAGE_HAS_LIBUDEV
	help
	  eudev is a fork of systemd-udev with the goal of obtaining
	  better compatibility with existing software such as OpenRC and
	  Upstart, older kernels, various toolchains and anything else
	  required by users and various distributions.

	  https://github.com/eudev-project/eudev

if BR2_PACKAGE_EUDEV

config BR2_PACKAGE_PROVIDES_LIBUDEV
	default "eudev"

config BR2_PACKAGE_EUDEV_DAEMON_DUMMY
	bool "udev daemon"
	depends on BR2_ROOTFS_DEVICE_CREATION_DYNAMIC_EUDEV
	help
	  Install the udev daemon.

# Use the dummy symbol for proper indetation
if BR2_PACKAGE_EUDEV_DAEMON_DUMMY

config BR2_PACKAGE_PROVIDES_UDEV
	default "eudev"

config BR2_PACKAGE_EUDEV_MODULE_LOADING
	bool "enable kernel module loading"
	default y
	select BR2_PACKAGE_KMOD
	help
	  Enable kernel module loading support

config BR2_PACKAGE_EUDEV_RULES_GEN
	bool "enable rules generator"
	help
	  Enable persistent rules generator

endif # BR2_PACKAGE_EUDEV_DAEMON

config BR2_PACKAGE_EUDEV_ENABLE_HWDB
	bool "enable hwdb installation"
	default y
	select BR2_PACKAGE_HOST_EUDEV # for udevadm, during target-finalize
	help
	  Enables hardware database installation to /etc/udev/hwdb.bin

comment "udev daemon needs eudev /dev management"
	depends on BR2_USE_MMU
	depends on !BR2_ROOTFS_DEVICE_CREATION_DYNAMIC_EUDEV

endif # BR2_PACKAGE_EUDEV

comment "eudev needs a toolchain w/ wchar, dynamic library"
	depends on BR2_USE_MMU
	depends on !BR2_USE_WCHAR || BR2_STATIC_LIBS
	depends on !BR2_INIT_SYSTEMD

comment "eudev is incompatible with systemd init"
	depends on BR2_INIT_SYSTEMD
